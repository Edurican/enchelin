name: Backend CI (Test Only)

on:
  push:
    branches: [ "dev" ] # dev 브랜치에 푸시될 때 실행
    paths:
      - 'backend/**'    # backend 폴더가 변경되었을 때만 실행

permissions:
  contents: read

jobs:
  test-and-build:
    runs-on: ubuntu-latest

    # 작업 디렉토리를 아예 backend로 고정 (cd backend 안 해도 됨)
    defaults:
      run:
        working-directory: ./backend

    steps:
      # 1. 코드 가져오기
      - uses: actions/checkout@v3

      # 2. 자바 17 세팅
      - name: Set up JDK 17
        uses: actions/setup-java@v3
        with:
          java-version: '17'
          distribution: 'temurin'

      # 3. Gradle 권한 부여
      - name: Grant execute permission for gradlew
        run: chmod +x gradlew

      # 4. 테스트 및 빌드 실행 (DB 없이도 빌드되게 -x test 옵션 쓸 수도 있음)
      # 정석대로라면 테스트를 돌려야 하지만, DB 연결 문제로 귀찮으면 './gradlew build -x test' 사용
      - name: Build with Gradle
        run: ./gradlew clean build